<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html xmlns:mshelp="http://msdn.microsoft.com/mshelp">
<head>
  <title>How to use FTPS (introduction)</title>


  <meta name="generator" content="HelpMaker.net">

  <meta name="keywords" content="Chapter 3,">

  <link rel="stylesheet" type="text/css" href="ms-help://Hx/HxRuntime/HxLink.css">

  <link rel="stylesheet" type="text/css" href="ms-help://Hx/HxRuntime/HxLinkDefault.css">

</head>


<body style="background-color: rgb(255, 255, 255);">

<table cellpadding="0" cellspacing="0" width="100%">

  <tbody>

    <tr>

      <td style="background-image: url(../images/bk_tl.jpg); background-repeat: repeat-x;"><img src="../images/space.gif" height="4" width="4"></td>

      <td style="background-image: url(../images/bk_t.jpg); background-repeat: repeat-x;"><img src="../images/space.gif" height="4" width="4"></td>

      <td style="background-image: url(../images/bk_tr.jpg); background-repeat: repeat-x;"><img src="../images/space.gif" height="4" width="4"></td>

    </tr>

    <tr>

      <td style="background-image: url(../images/bk_l.jpg); background-repeat: repeat-y;" width="4"><img src="../images/space.gif" height="4" width="4"></td>

      <td style="font-family: sans-serif; font-weight: bold; font-size: 14pt; background-image: url(../images/bk_c.jpg); background-repeat: repeat;" width="100%"> &nbsp;How to use FTPS (introduction) </td>

      <td style="background-image: url(../images/bk_r.jpg); background-repeat: repeat-y;" width="4"><img src="../images/space.gif" height="4" width="4"></td>

    </tr>

    <tr>

      <td style="background-image: url(../images/bk_bl.jpg); background-repeat: repeat-x;" height="4"><img src="../images/space.gif" height="4" width="4"></td>

      <td style="background-image: url(../images/bk_b.jpg); background-repeat: repeat-x;"><img src="../images/space.gif" height="4" width="4"></td>

      <td style="background-image: url(../images/bk_br.jpg); background-repeat: repeat-x;"><img src="../images/space.gif" height="4" width="4"></td>

    </tr>

  </tbody>
</table>

<br>

<div align="left"><font color="#010101" face="Arial"><span style="font-size: 10pt;"><a href="../../api/com/enterprisedt/net/ftp/ssl/SSLFTPClient.html"><font color="#0000ff" face="Arial"><span style="font-size: 10pt;"><u>SSLFTPClient</u></span></font></a></span></font><font color="#010101" face="Arial"><span style="font-size: 10pt;">&nbsp;should be used once
secure file transfers are
required via FTPS.&nbsp;</span></font><font color="#010101" face="Arial"><span style="font-size: 10pt;"><a href="../../api/com/enterprisedt/net/ftp/FTPClient.html"><font color="#0000ff" face="Arial"><span style="font-size: 10pt;"><u>FTPClient</u></span></font></a></span></font><font color="#010101" face="Arial"><span style="font-size: 10pt;"> and&nbsp;</span></font><font><u><font color="#010101" face="Arial"><a href="../../api/com/enterprisedt/net/ftp/pro/ProFTPClient.html"><font color="#0000ff" face="Arial"><span style="font-size: 10pt;"><u>ProFTPClient</u></span></font></a></font></u></font><font color="#010101" face="Arial"><span style="font-size: 10pt;"> do not support secure
transfers.&nbsp;</span></font><font color="#010101" face="Arial"><span style="font-size: 10pt;"><a href="../../api/com/enterprisedt/net/ftp/ssh/SSHFTPClient.html"><font color="#0000ff" face="Arial"><span style="font-size: 10pt;"><u>SSHFTPClient</u></span></font></a>
supports the SFTP protocol, which is unrelated to FTPS.</span></font></div>

<div align="left"><br>

</div>

<div align="left"><font color="#010101" face="Arial"><span style="font-size: 10pt;">The
basic elements of configuring an FTPS connection are:<br>

</span></font></div>

<div align="left"><br>

</div>

<div style="margin-left: 13mm; margin-right: 0mm; text-indent: -6mm;" align="left"><font color="#010101" face="Symbol"><span style="font-size: 10pt;">&middot;&nbsp;&nbsp;&nbsp;&nbsp;</span></font><font color="#010101" face="Arial"><span style="font-size: 10pt;"><b>FTPS Type:&nbsp;</b></span></font><font color="#010101" face="Arial"><span style="font-size: 10pt;"></span></font><font><u><font color="#010101" face="Arial"><a href="../../api/com/enterprisedt/net/ftp/ssl/SSLFTPClient.html"><font color="#0000ff" face="Arial"><span style="font-size: 10pt;"><u>SSLFTPClient</u></span></font></a></font></u></font><a href="ms-help://edtFTPnetPRO/edtftpnetpro-api/EnterpriseDT.Net.Ftp.SecureFTPConnection.html"><font color="#0000ff" face="Arial"><span style="font-size: 10pt;"></span></font></a><font color="#010101" face="Arial"><span style="font-size: 10pt;"> supports both </span></font><a href="implicitftpsandexplicitftps.html"><font color="#0000ff" face="Arial"><span style="font-size: 10pt;"><u>explicit and implicit FTPS</u></span></font></a><font color="#010101" face="Arial"><span style="font-size: 10pt;">, as well
as standard FTP. Explicit FTPS is the default, and implicit FTPS (which
is an obsolete form of FTPS) can&nbsp;be chosen using the </span></font><a href="../../api/com/enterprisedt/net/ftp/ssl/SSLFTPClient.html#setImplicitFTPS%28boolean%29"><font color="#0000ff" face="Arial"><span style="font-size: 10pt;"><u>setImplicitFTPS </u></span></font></a><font color="#010101" face="Arial"><span style="font-size: 10pt;">method.<br>

<br>

</span></font></div>

<div style="margin-left: 13mm; margin-right: 0mm; text-indent: -6mm;" align="left"><font color="#010101" face="Symbol"><span style="font-size: 10pt;">&middot;&nbsp;&nbsp;&nbsp;&nbsp;</span></font><font color="#010101" face="Arial"><span style="font-size: 10pt;"><b>Server Validation: </b></span></font><a href="serverandclientvalidation.html"><font color="#0000ff" face="Arial"><span style="font-size: 10pt;"></span></font></a><font color="#010101" face="Arial"><span style="font-size: 10pt;">validation of the server is an
important issue in FTPS. By default an
attempt will be made to validate the server's certificate (which is
provided by the server) using the </span></font><a href="certificatesandcertificateauthoritiescas.html"><font color="#0000ff" face="Arial"><span style="font-size: 10pt;"><u>root certificates</u></span></font></a><font color="#010101" face="Arial"><span style="font-size: 10pt;"> previously loaded into the
client's
certificate store</span></font><font color="#010101" face="Arial"><span style="font-size: 10pt;">. </span></font><font color="#010101" face="Arial"><span style="font-size: 10pt;"></span></font><font color="#010101" face="Arial"><span style="font-size: 10pt;">If this is successful, the
client's&nbsp;</span></font><font><u><font color="#010101" face="Arial"><a href="../../api/com/enterprisedt/net/ftp/ssl/SSLFTPValidator.html"><font color="#0000ff" face="Arial"><span style="font-size: 10pt;"><u>SSLFTPValidator</u></span></font></a></font></u></font><font color="#010101" face="Arial"><span style="font-size: 10pt;"> will then attempt to validate the
certificate.<br>

<br>

</span></font></div>

<div style="margin-left: 13mm; margin-right: 0mm; text-indent: -6mm;" align="left"><font color="#010101" face="Symbol"><span style="font-size: 10pt;">&middot;&nbsp;&nbsp;&nbsp;&nbsp;</span></font><font color="#010101" face="Arial"><span style="font-size: 10pt;"><b>Client Authentication: </b>Some
servers require clients to </span></font><a href="serverandclientvalidation.html"><font color="#0000ff" face="Arial"><span style="font-size: 10pt;"><u>authenticate</u></span></font></a><font color="#010101" face="Arial"><span style="font-size: 10pt;">
themselves using a certificate. The client's certificate is loaded via
the&nbsp;</span></font><font><u><font color="#010101" face="Arial"><a href="../../api/com/enterprisedt/net/ftp/ssl/SSLFTPClient.html#loadClientCertificate%28java.lang.String,%20java.lang.String%29"><font color="#0000ff" face="Arial"><span style="font-size: 10pt;"><u>loadClientCertificate</u></span></font></a></font></u></font><font color="#010101" face="Arial"> method or the <a href="../../api/com/enterprisedt/net/ftp/ssl/SSLFTPClient.html#setClientCertificate%28java.security.cert.Certificate,%20java.security.PrivateKey%29"><font color="#0000ff" face="Arial"><span style="font-size: 10pt;"><u>setClientCertificate</u></span></font></a>
<span style="font-size: 10pt;">method.</span></font></div>

<div align="left"><br>

</div>

<div align="left"><font color="#010101" face="Arial"><span style="font-size: 11pt;"><b>Validation
of Server Certificates</b></span></font></div>

<div align="left"><br>

</div>

<div align="left"><a href="ms-help://edtFTPnetPRO/edtftpnetpro-api/EnterpriseDT.Net.Ftp.SecureFTPConnection.html"><font color="#010101" face="Arial"><span style="font-size: 10pt;"></span></font></a><font color="#010101" face="Arial"><span style="font-size: 10pt;">Usage
of server validation is strongly recommended since it virtually
eliminates the possibility
of communicating with the wrong server. While developing
code, however, the programmer
might like to postpone any possible certificate validation issues by
disabling server validation
by using </span></font><font color="#010101" face="Arial"><a href="../../api/com/enterprisedt/net/ftp/ssl/SSLFTPClient.html#setValidateServer%28boolean%29"><font color="#0000ff" face="Arial"><span style="font-size: 10pt;"><u>setValidateServer(false)</u></span></font></a><span style="font-size: 10pt;">. Note that server validation
should never be disabled on production systems.</span></font><br>

<font color="#010101" face="Arial"><br>

When server validation is enabled (which is the default), server
certificates are validated when control channels are switched to TLS.
This&nbsp;happens when the&nbsp;</font><font><u><font color="#010101" face="Arial"><a href="../../api/com/enterprisedt/net/ftp/ssl/SSLFTPClient.html#auth%28java.lang.String%29"><font color="#0000ff" face="Arial"><span style="font-size: 10pt;"><u>auth</u></span></font></a></font></u></font><font color="#010101" face="Arial"> method is called.<br>

<br>

The first step in server validation is to check the certificate chain.
The certificate of the&nbsp;</font><font color="#010101" face="Arial"><span style="font-size: 10pt;"></span></font><a href="certificatesandcertificateauthoritiescas.html"><font color="#0000ff" face="Arial"><span style="font-size: 10pt;"><u>CA</u></span></font></a><font color="#010101" face="Arial"> that issued the
certificate must be loaded by the client. &nbsp;This is done via
the </font><font><u><font color="#010101" face="Arial"><a href="../../api/com/enterprisedt/net/ftp/ssl/SSLFTPCertificateStore.html"><font color="#0000ff" face="Arial"><span style="font-size: 10pt;"><u>SSLFTPCertificateStore</u></span></font></a></font></u></font><font color="#010101" face="Arial">,
which is obtained by calling <a href="../../api/com/enterprisedt/net/ftp/ssl/SSLFTPClient.html#getRootCertificateStore%28%29"><font color="#0000ff" face="Arial"><span style="font-size: 10pt;"><u>getRootCertificateStore</u></span></font></a>.&nbsp;</font><font><u><font><u><font color="#010101" face="Arial"><a href="../../api/com/enterprisedt/net/ftp/ssl/SSLFTPCertificateStore.html"><font color="#0000ff" face="Arial"><span style="font-size: 10pt;"><u>SSLFTPCertificateStore</u></span></font></a></font></u></font></u></font><font color="#010101" face="Arial">
maintains a list of certificate objects that can be loaded from various
file formats such as PEM and Java keystores. &nbsp;</font><br>

<font color="#010101" face="Arial"><br>

Alternatively, if the certificate was not issued by a CA,
then the actual server certificate may be loaded.<br>

<br>

The second step in server validation is performed after the certificate
chain is checked, and involves the </font><font><u><font><u><font color="#010101" face="Arial"><a href="../../api/com/enterprisedt/net/ftp/ssl/SSLFTPValidator.html"><font color="#0000ff" face="Arial"><span style="font-size: 10pt;"><u>SSLFTPValidator</u></span></font></a></font></u></font></u></font><font color="#010101" face="Arial"> interface. By
default,&nbsp; the client instance has a default implementation of
this interface set, called </font><font><u><font><u><font><u><font color="#010101" face="Arial"><a href="../../api/com/enterprisedt/net/ftp/ssl/SSLFTPStandardValidator.html"><font color="#0000ff" face="Arial"><span style="font-size: 10pt;"><u>SSLFTPStandardValidator</u></span></font></a></font></u></font></u></font></u></font><font color="#010101" face="Arial">.&nbsp; <br>

<br>

The </font><font><u><font><u><font><u><font><u><font color="#010101" face="Arial"><a href="../../api/com/enterprisedt/net/ftp/ssl/SSLFTPStandardValidator.html"><font color="#0000ff" face="Arial"><span style="font-size: 10pt;"><u>SSLFTPStandardValidator</u></span></font></a></font></u></font></u></font></u></font></u></font><font color="#010101" face="Arial">&nbsp;performs a
number of checks on the server certificate:<br>

</font>
<ol>

  <li><font color="#010101" face="Arial"><span style="font-size: 10pt;">Check
to see if the client recommends that the certificate should be
accepted. This happens if (1) the server's certificate was verified
from the root certificates store (see <a href="../../api/com/enterprisedt/net/ftp/ssl/SSLFTPClient.html#getRootCertificateStore%28%29"><code></code></a></span></font><font><u><font color="#010101" face="Arial"><a href="../../api/com/enterprisedt/net/ftp/ssl/SSLFTPClient.html#getRootCertificateStore%28%29"><font color="#0000ff" face="Arial"><span style="font-size: 10pt;"><u>getRootCertificateStore</u></span></font></a></font></u></font><font color="#010101" face="Arial"><span style="font-size: 10pt;"><a href="../../api/com/enterprisedt/net/ftp/ssl/SSLFTPClient.html#getRootCertificateStore%28%29"><code></code></a>)
or (2) server validation has been switched off via&nbsp;</span></font><font color="#010101" face="Arial"><a href="../../api/com/enterprisedt/net/ftp/ssl/SSLFTPClient.html#setValidateServer%28boolean%29"><font color="#0000ff" face="Arial"><span style="font-size: 10pt;"><u>setValidateServer(false)</u></span></font></a><span style="font-size: 10pt;">.</span></font></li>

  <li><font color="#010101" face="Arial"><span style="font-size: 10pt;">Ensure that the length of the
certificate chain is no more
than 2, which indicates that the certificate was issued to the server
directly by a CA (Certificate Authority).&nbsp;</span></font></li>

  <li><font color="#010101" face="Arial"><span style="font-size: 10pt;">Check that the CN (Common Name) of
the subject of the
server certificate matches the server's hostname.</span></font></li>

  <li><font color="#010101" face="Arial"><span style="font-size: 10pt;">Check that today's date is within
the valid period of the
certificate.</span></font><br>

  </li>

</ol>

</div>

<div align="left"><font color="#010101" face="Arial"><span style="font-size: 10pt;">Regarding 2): </span></font><font color="#010101" face="Arial"><span style="font-size: 10pt;">Note
that the enforced maximum length of the certificate chain can be
increased if required. This can be
done with the code below:</span></font></div>

<div style="margin-left: 13mm; margin-right: 0mm; text-indent: 0mm;" align="left"> <br>

<font face="Lucida Console" size="1"><span style="font-size: 8pt;">SSLFTPStandardValidator.MAX_CERTIFICATE_CHAIN_LENGTH
= 3;<br>

<br>

</span></font> </div>

<div align="left"><font color="#010101" face="Arial"><span style="font-size: 10pt;">Sometimes
3), the hostname checking, can be problematic. It can be disabled
completely (not recommended) by creating a new instance of </span></font><font><u><font><u><font><u><font color="#010101" face="Arial"><a href="../../api/com/enterprisedt/net/ftp/ssl/SSLFTPStandardValidator.html"><font color="#0000ff" face="Arial"><span style="font-size: 10pt;"><u>SSLFTPStandardValidator</u></span></font></a></font></u></font></u></font></u></font><font color="#010101" face="Arial"><span style="font-size: 10pt;">, using a <a href="../../api/com/enterprisedt/net/ftp/ssl/SSLFTPStandardValidator.html#SSLFTPStandardValidator%28boolean%29">constructor
that disables hostname checking</a>. Alternatively, <a href="../../api/com/enterprisedt/net/ftp/ssl/SSLFTPStandardValidator.html#SSLFTPStandardValidator%28java.lang.String%29">another
constructor</a> permits the setting of the hostname to check
against rather than the server's hostname. The client must be passed
the&nbsp;new instance via the <a href="../../api/com/enterprisedt/net/ftp/ssl/SSLFTPClient.html#setCustomValidator%28com.enterprisedt.net.ftp.ssl.SSLFTPValidator%29">setCustomValidator</a>
method.</span></font></div>

<div align="left"><br>

</div>

<div align="left"><font color="#010101" face="Arial"><span style="font-size: 10pt;">If
the above tweaks are not sufficient, a custom validator can be written
that implements the </span></font><font><u><font><u><font color="#010101" face="Arial"><a href="../../api/com/enterprisedt/net/ftp/ssl/SSLFTPValidator.html"><font color="#0000ff" face="Arial"><span style="font-size: 10pt;"><u>SSLFTPValidator</u></span></font></a></font></u></font></u></font><font color="#010101" face="Arial"> interface and does your
own validation. This could be quite easily done by subclassing </font><font><u><font><u><font><u><font><u><font color="#010101" face="Arial"><a href="../../api/com/enterprisedt/net/ftp/ssl/SSLFTPStandardValidator.html"><font color="#0000ff" face="Arial"><span style="font-size: 10pt;"><u>SSLFTPStandardValidator</u></span></font></a></font></u></font></u></font></u></font></u></font><font color="#010101" face="Arial">&nbsp;and
overwriting some of its protected methods. &nbsp;Again, </font><font color="#010101" face="Arial"><span style="font-size: 10pt;">the client must be passed
the&nbsp;instance of the custom validator via the <a href="../../api/com/enterprisedt/net/ftp/ssl/SSLFTPClient.html#setCustomValidator%28com.enterprisedt.net.ftp.ssl.SSLFTPValidator%29">setCustomValidator</a>
method.</span></font>
</div>

<div align="left"><br>

</div>

<div align="left"><font color="#010101" face="Arial"><span style="font-size: 11pt;"><b>Loading
Client Certificates<br>

<br>

</b></span></font></div>

<div align="left"><font color="#010101" face="Arial"><span style="font-size: 10pt;">In
addition to the standard user-name/password authentication, some FTPS
servers require
clients to present certificates of their own.&nbsp;</span></font><a href="ms-help://edtFTPnetPRO/edtftpnetpro-api/EnterpriseDT.Net.Ftp.SecureFTPConnection.html"><font color="#0000ff" face="Arial"><span style="font-size: 10pt;"></span></font></a><font color="#010101" face="Arial"><span style="font-size: 10pt;"> </span></font></div>

<div align="left"><br>

</div>

<div align="left"><font color="#010101" face="Arial"><span style="font-size: 10pt;">To
utilize this functionality, the client's certificate and private key
must be supplied. T</span></font><font color="#010101" face="Arial"><span style="font-size: 10pt;">he&nbsp;<a href="../../api/com/enterprisedt/net/ftp/ssl/SSLFTPClient.html#loadClientCertificate%28java.lang.String,%20java.lang.String%29">loadClientCertificate</a>
method is used to load the client's private key and certificate in PEM
format from the supplied file. Alternatively, <a href="../../api/com/enterprisedt/net/ftp/ssl/SSLFTPClient.html#setClientCertificate%28java.security.cert.Certificate,%20java.security.PrivateKey%29">setClientCertificate</a>
can be used to supply a Java Certificate object and PrivateKey.</span></font></div>

<div align="left"><br>

</div>

<font color="#010101" face="Arial"><span style="font-size: 10pt;">The
topic </span></font><a href="obtainingkeysandcertificates.html"><font color="#0000ff" face="Arial"><span style="font-size: 10pt;"><u>Obtaining Keys and
Certificates</u></span></font></a><font color="#010101" face="Arial"><span style="font-size: 10pt;">
for instructions on producing keys and certificates.
A general overview of private/public keys is presented in the topic </span></font><a href="publickeycryptography.html"><font color="#0000ff" face="Arial"><span style="font-size: 10pt;"><u>Public
Key Cryptography</u></span></font></a><font color="#010101" face="Arial"><span style="font-size: 10pt;">.</span></font><br>

<div align="left"><font color="#010101"><br>

</font></div>

<div align="left"><font color="#010101" face="Arial"><span style="font-size: 11pt;"><b>Cipher
Suites</b></span></font></div>

<div align="left"><br>

</div>

<div align="left"><font color="#010101" face="Arial"><span style="font-size: 10pt;">For
a client and a server to be able to communicate they must be able to
agree on a common
cipher suite. A set of cipher suites are enabled by default and in most
cases the server will
support one of these, meaning that no action is required by the
developer. There may be
cases where the server doesn't support any of the enabled
cipher-suites. If this happens then
the library will throw an exception when authentication takes place. </span></font><font color="#010101" face="Arial"><span style="font-size: 10pt;">Some servers &ndash;
particular older servers adhering to the now defunct US export rules
&ndash; may only support 40 bit
encryption. Use of such ciphers is not recommended as they offer
relatively poor security. The
topic, </span></font><a href="selectingciphers.html"><font color="#0000ff" face="Arial"><span style="font-size: 10pt;"><u>Selecting Ciphers</u></span></font></a><font color="#010101" face="Arial"><span style="font-size: 10pt;">, offers advice on selection of
ciphers.</span></font></div>

<div align="left"></div>

<div align="left"><font color="#010101" face="Arial"><span style="font-size: 10pt;">To
obtain a list of currently enabled cipher-suites, use <a href="../../api/com/enterprisedt/net/ftp/ssl/SSLFTPClient.html#getEnabledCipherSuites%28%29">getEnabledCipherSuites</a>.
To
enable specific ciphers, first <a href="../../api/com/enterprisedt/net/ftp/ssl/SSLFTPClient.html#disableAllCipherSuites%28%29">disableAllCipherSuites</a>
and then use
<a href="../../api/com/enterprisedt/net/ftp/ssl/SSLFTPClient.html#enableCipherSuite%28com.enterprisedt.net.ftp.ssl.SSLFTPCipherSuite%29">enableCipherSuite</a>
to enable the ciphers required.<br>

</span></font></div>

</body>
</html>
