<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">

<html><head><meta http-equiv="Content-Type" content="text/html; charset=Windows-1251"><title>Описание - TestUtility</title><link rel="stylesheet" type="text/css" href="../../styles/main.css"><script language=JavaScript src="../../javascript/main.js"></script><script language=JavaScript src="../../javascript/searchdata.js"></script></head><body class="ContentPage" onLoad="NDOnLoad();"><script language=JavaScript><!--
if (browserType) {document.write("<div class=" + browserType + ">");if (browserVer) {document.write("<div class=" + browserVer + ">"); }}// --></script>

<!--  Generated by Natural Docs, version 1.5 -->
<!--  http://www.naturaldocs.org  -->

<!-- saved from url=(0026)http://www.naturaldocs.org -->




<div id=Content><div class="CSection"><div class=CTopic id=MainTopic><h1 class=CTitle><a name="Описание"></a>Описание</h1><div class=CBody><p>Модуль TestUtility содержит набор функций для создания тестовых сценариев по внутреннему тестированию различных модулей.</p><h4 class=CHeading>Набор функций модуля</h4><table border=0 cellspacing=0 cellpadding=0 class=CDescriptionList><tr><td class=CDLEntry>beginTest</td><td class=CDLDescription>инициализирует новый тест</td></tr><tr><td class=CDLEntry>endTest</td><td class=CDLDescription>завершает тест с указанием результата (OK, FAILED).&nbsp; В случае неуспешного выполнения теста к результату добавляется сообщение с описанием причины неудачи</td></tr><tr><td class=CDLEntry>failTest</td><td class=CDLDescription>завершение теста при неуспешном результате</td></tr><tr><td class=CDLEntry>addTestInfo</td><td class=CDLDescription>добавляет дополнительную информацию по тесту</td></tr><tr><td class=CDLEntry>getTestTimeSecond</td><td class=CDLDescription>возвращает время выполнения теста в секундах</td></tr><tr><td class=CDLEntry>compareChar</td><td class=CDLDescription>сравнивает текущую строку с ожидаемой и в случае расхождений завершает тест с неуспешным результатом</td></tr><tr><td class=CDLEntry>compareRowCount</td><td class=CDLDescription>сравнивает текущее кол-во строк в источнике (таблица, ref-курсор) с ожидаемым и в случае расхождений завершает тест с неуспешным результатом</td></tr></table><h4 class=CHeading>Структура теста</h4><p>В общем простейшем случае структура теста выглядит следующим образом</p><blockquote><pre>начало теста
  результат := проверяемая_функция();
  if результат != ожидаемый_результат then
    завершаем тест с неуспешным результатом;
  end if;
завершение теста</pre></blockquote><h4 class=CHeading>Пример</h4><blockquote><pre>...
pkg_TestUtility.beginTest( ... );
begin
  testId := pkg_&lt;&lt;PACKAGE_NAME&gt;&gt;.create( ... );

  if testId is not null then
    if not isException then
      pkg_TestUtility.compareRowCount(
          tableName        =&gt; 'test_table'
        , filterCondition  =&gt; 'test_id = ' || to_char( testId )
        , expectedRowCount =&gt; 1
        , failMessageText  =&gt; 'Test row is not created'
        );
    else
      pkg_TestUtility.failTest( 'Must be exception as result' );
    end if;
  else
    pkg_TestUtility.failTest( 'Test row Id is null' );
 end if;

exception
  when others then
    if isException then
      logger.trace( 'Message: ' || pkg_Logging.getErrorStack() );
    else
      pkg_TestUtility.failTest( 'Exception: ' || pkg_Logging.getErrorStack() );
    end if;
end;
pkg_TestUtility.endTest();
...</pre></blockquote><p>В данном тесте по переданному набору параметров создается тестовая строка (с помощью вызова pkg_&lt;&lt;PACKAGE_NAME&gt;&gt;.create()) и анализируется результат её создания.</p><p>В зависимости от тестового сценария, корректным результатом может быть один из следующих вариантов</p><ul><li>Запись создана, её идентификатор передан в testId и в таблице test_table есть запись с test_id = to_char( testId )</li><li>Функция создания записи pkg_&lt;&lt;PACKAGE_NAME&gt;&gt;.create() завершилась с ошибкой (вернула исключение)</li><li>Функция создания записи отработала без ошибок, но идентификатор testId пустой</li><li>Функция создания записи отработала без ошибок, но по возвращенному идентификатору testId нет записей в таблице test_table</li><li>и т.п.</li></ul><p>Можно составить несколько тестовых сценариев, в которых будут проверяться ситуации создания записей с отсутствием каких-нибудь обязательных параметров, с недопустимым сочетанием параметров и т.п.</p><p>Аналогичным образом можно создать следующие тестовые сценарии</p><ul><li>обновление параметров записей - создается тестовая запись и обновляется один (или несколько) её параметров.&nbsp; Далее с помощью pkg_TestUtility.compareRowCount() проверяется, что эти параметры действительно изменили своё значение.&nbsp; Также может анализироваться ситуация, при которой корректным поведением будет возврат исключения (например, при указании недопустимого значения обновляемого параметра)</li><li>удаление записей - создается тестовая строка (или используется существующая) и удаляется с помощью интерфейсной функции.&nbsp; Корректным результатом может быть установка признака deleted = 1 (при логическом удалении), либо отсутствие записи в таблице (при физическом удалении)</li><li>поиск записей (find) - создается тестовая строка (или используется существующая) и с помощью интерфейсной функции выполняется её поиск.&nbsp; Возвращаемый ref-курсор с помощью pkg_TestUtility.compareRowCount() анализируется на наличие требуемой записи</li><li>получение списка строк (get) - создается тестовая запись (или используется существующая) и с помощью интерфейсной функции выполняется получение списка, в котором она должна быть.&nbsp; Возвращаемый ref-курсор со списком с помощью pkg_TestUtility.compareRowCount() анализируется на наличие требуемой записи</li></ul><h4 class=CHeading>Пример тестирования длительности работы функции/процедуры</h4><blockquote><pre>begin
  ...
  pkg_TestUtility.beginTest( ... );

  rc := pkg_&lt;&lt;PACKAGE_NAME&gt;&gt;.find( ... );

  responseTime := pkg_TestUtility.getTestTimeSecond();
  pkg_TestUtility.addTestInfo( ' (' || to_char( responseTime ) || ' sec)' );

  if responseTime &gt; timeLimitSec then
    pkg_TestUtility.failTest( 'Response time of find() exceeds ' || to_char( timeLimitSec ) || ' seconds!' );
  end if;
  pkg_TestUtility.endTest();
  ...
end;</pre></blockquote><table border=0 cellspacing=0 cellpadding=0 class=CDescriptionList><tr><td class=CDLEntry>pkg_&lt;&lt;PACKAGE_NAME&gt;&gt;.find()</td><td class=CDLDescription>тестируемая функция</td></tr></table><p>В данном примере используется функция получения длительности выполнения теста pkg_TestUtility.getTestTimeSecond().&nbsp; Отсчет времени начинается от момента вызова pkg_TestUtility.beginTest().&nbsp; Полученное время работы теста (responseTime) можно сравнить с эталонным временем (timeLimitSec в примере) и прервать тест, если производительность тестируемой функции неприемлема.</p><p>Следует помнить, что повторный вызов функции при незначительном изменении параметров обычно выполняется значительно быстрее, что объясняется загрузкой используемых блоков индексов/данных в буфер-кэш БД.&nbsp; Принимая это во внимание, рекомендуется создавать не менее двух тестов на производительность одной функции, первый тест из которых имеет больший лимит по времени, чем второй и последующие.&nbsp; Другими словами, например, пользователи могут подождать 10-20 секунд при первом вызове функции, если последующие запуски не будут превышать 1 секунду, что и можно отразить в виде сценариев.</p><h4 class=CHeading>Структура в OMS</h4><p>Функционал по внутреннему тестированию модуля размещается в целевом модуле по пути DB/Test и включает в себя пакет с именем pkg_&lt;Имя модуля&gt;Test, набор скриптов *.sql с реализацией тестовых сценариев и скрипт run.sql для выполнения тестовых сценариев в нужном порядке.</p><h4 class=CHeading>Установка пакета для внутреннего тестирования модуля выполняется с помощью команды</h4><blockquote><pre>$ make install-test LOAD_USERID=???/??? LOAD_OPERATORID=???/???</pre></blockquote><h4 class=CHeading>Запуск внутреннего тестирования выполняется с помощью команды (для OMS версии 1.6.4 и выше)</h4><blockquote><pre>$ make test LOAD_USERID=???/??? LOAD_OPERATORID=???/???</pre></blockquote><h4 class=CHeading>Пример вывода</h4><blockquote><pre>$ make install-test LOAD_USERID=???/???@??? LOAD_OPERATORID=???/???
Test/pkg_Test.pks: -&gt; ???@??? ...
Package created.
No errors.
Test/pkg_Test.pkb: -&gt; ???@??? ...
Package body created.
No errors.

$ make test LOAD_USERID=scoring/???@??? LOAD_OPERATORID=???/???
Test/run.sql: -&gt; ???@??? ...
Test/test-row.sql: ...
16:09:41,542:      : INFO : Create test row (normal)                                : OK
16:09:41,557:    15: INFO : Create test row (invalid code)                          : OK
16:09:41,588:    15: INFO : Update test row                                         : OK
16:09:41,620:    16: INFO : Delete test row (normal)                                : OK
16:09:41,620:     0: INFO : Delete test row (without test_id)                       : OK
16:09:41,651:    31: INFO : Find test row (id)                                      : OK
16:09:41,682:    15: INFO : Get test row list                                       : OK
PL/SQL procedure successfully completed.
No errors.</pre></blockquote><p>По умолчанию, при запуске команды, приведенной выше, осуществляется выполнение скрипта run.sql из каталога DB/Test.&nbsp; Если необходимо выполнить другой скрипт, то в команду нужно добавить переменную TEST_SCRIPT с указанием имени скрипта, например TEST_SCRIPT=logic.sql</p><p>Для тестирования отсутствует версионность (указание версии в INSTALL_VERSION), т.к.&nbsp; при любой доработке модуля должны успешно выполняться ВСЕ внутренние тесты.&nbsp; Если какие-то из тестов потеряли свою актуальность, то их нужно обновить / удалить.</p><h4 class=CHeading>Заключительные замечания</h4><p>Хорошей практикой является создание тестовых сценариев по очередной доработке ДО начала этой доработки (т.н.&nbsp; TDD (Test Driven Development)).&nbsp; Т.е.&nbsp; до начала доработки придумывается и реализуется набор сценариев, которыми можно будет проверить, что доработка выполнена корректно (что функционал работает в соответствии с требованиями к нему).&nbsp; Естественно, что все тестовые сценарии вначале будут завершены неуспешно, т.к.&nbsp; на тот момент ещё отсутствует проверяемый функционал, однако, по мере выполнения доработки всё больше и больше тестов будут завершаться успешно...</p><p>При поступлении инцидентов от тестировщиков / пользователей необходимо сначала реализовать тестовый сценарий, который повторяет ошибочную ситуацию и только после этого приступать к исправлению, в итоге добившись того, что тестовый сценарий завершится успешно.</p><p><u>Естественно, что такой подход в начале приведет к некоторому увеличению времени на разработку, однако, потом всё это многократно окупится, благодаря снижению временных затрат на тестирование (т.к.&nbsp; один раз качественно написанные тесты могут служить гарантией корректного функционирования модуля) и значительному снижению кол-ва ошибок, на исправление которых нужно будет потом отвлекаться от других задач.</u></p></div></div></div>

</div><!--Content-->


<div id=Footer><a href="http://www.naturaldocs.org">Generated by Natural Docs</a></div><!--Footer-->


<div id=Menu><div class=MTitle>TestUtility<div class=MSubTitle>Версия 1.0.3</div></div><div class=MEntry><div class=MGroup><a href="javascript:ToggleMenu('MGroupContent1')">О модуле</a><div class=MGroupContent id=MGroupContent1><div class=MEntry><div class=MFile id=MSelected>Описание</div></div><div class=MEntry><div class=MFile><a href="install-txt.html">Установка</a></div></div><div class=MEntry><div class=MFile><a href="bugs-txt.html">Ошибки</a></div></div><div class=MEntry><div class=MFile><a href="todo-txt.html">Доработки</a></div></div><div class=MEntry><div class=MFile><a href="../Makefile-.html">Сборка</a></div></div><div class=MEntry><div class=MFile><a href="version-txt.html">Версии</a></div></div></div></div></div><div class=MEntry><div class=MGroup><a href="javascript:ToggleMenu('MGroupContent3')">Пакеты</a><div class=MGroupContent id=MGroupContent3><div class=MEntry><div class=MGroup><a href="javascript:ToggleMenu('MGroupContent2')">pkg_TestUtility</a><div class=MGroupContent id=MGroupContent2><div class=MEntry><div class=MFile><a href="../pkg_TestUtility-pks.html">Спецификация</a></div></div><div class=MEntry><div class=MFile><a href="../pkg_TestUtility-pkb.html">Реализация</a></div></div></div></div></div></div></div></div><div class=MEntry><div class=MGroup><a href="javascript:ToggleMenu('MGroupContent7')">Скрипты</a><div class=MGroupContent id=MGroupContent7><div class=MEntry><div class=MGroup><a href="javascript:ToggleMenu('MGroupContent6')">Install</a><div class=MGroupContent id=MGroupContent6><div class=MEntry><div class=MGroup><a href="javascript:ToggleMenu('MGroupContent5')">Grant</a><div class=MGroupContent id=MGroupContent5><div class=MEntry><div class=MGroup><a href="javascript:ToggleMenu('MGroupContent4')">Last</a><div class=MGroupContent id=MGroupContent4><div class=MEntry><div class=MFile><a href="../Install/Grant/Last/run-sql.html">run</a></div></div></div></div></div></div></div></div></div></div></div></div></div></div><div class=MEntry><div class=MGroup><a href="javascript:ToggleMenu('MGroupContent10')">Индекс</a><div class=MGroupContent id=MGroupContent10><div class=MEntry><div class=MGroup><a href="javascript:ToggleMenu('MGroupContent8')">Открытые объявления</a><div class=MGroupContent id=MGroupContent8><div class=MEntry><div class=MIndex><a href="../../index/Constants.html">Константы</a></div></div><div class=MEntry><div class=MIndex><a href="../../index/Functionspublic.html">Функции</a></div></div></div></div></div><div class=MEntry><div class=MGroup><a href="javascript:ToggleMenu('MGroupContent9')">Закрытые объявления</a><div class=MGroupContent id=MGroupContent9><div class=MEntry><div class=MIndex><a href="../../index/Variablesinternal.html">Переменные</a></div></div></div></div></div><div class=MEntry><div class=MIndex><a href="../../index/Functions.html">Функции</a></div></div><div class=MEntry><div class=MIndex><a href="../../index/Files.html">Скрипты</a></div></div><div class=MEntry><div class=MIndex><a href="../../index/General.html">Все вместе</a></div></div></div></div></div><script type="text/javascript"><!--
var searchPanel = new SearchPanel("searchPanel", "HTML", "../../search");
--></script><div id=MSearchPanel class=MSearchPanelInactive><input type=text id=MSearchField value=Search onFocus="searchPanel.OnSearchFieldFocus(true)" onBlur="searchPanel.OnSearchFieldFocus(false)" onKeyUp="searchPanel.OnSearchFieldChange()"><select id=MSearchType onFocus="searchPanel.OnSearchTypeFocus(true)" onBlur="searchPanel.OnSearchTypeFocus(false)" onChange="searchPanel.OnSearchTypeChange()"><option  id=MSearchEverything selected value="General">Everything</option><option value="Constants">Constants</option><option value="Files">Files</option><option value="Functions">Functions</option><option value="Functionspublic">Functions public</option><option value="Variablesinternal">Variables internal</option></select></div><script language=JavaScript><!--
HideAllBut([1, 3, 7, 10], 11);// --></script></div><!--Menu-->



<!--START_ND_TOOLTIPS-->
<!--END_ND_TOOLTIPS-->




<div id=MSearchResultsWindow><iframe src="" frameborder=0 name=MSearchResults id=MSearchResults></iframe><a href="javascript:searchPanel.CloseResultsWindow()" id=MSearchResultsWindowClose>Close</a></div>


<script language=JavaScript><!--
if (browserType) {if (browserVer) {document.write("</div>"); }document.write("</div>");}// --></script></body></html>