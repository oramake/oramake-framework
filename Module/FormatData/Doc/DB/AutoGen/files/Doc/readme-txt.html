<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">

<html><head><meta http-equiv="Content-Type" content="text/html; charset=Windows-1251"><title>Описание - FormatData</title><link rel="stylesheet" type="text/css" href="../../styles/main.css"><script language=JavaScript src="../../javascript/main.js"></script><script language=JavaScript src="../../javascript/searchdata.js"></script></head><body class="ContentPage" onLoad="NDOnLoad();"><script language=JavaScript><!--
if (browserType) {document.write("<div class=" + browserType + ">");if (browserVer) {document.write("<div class=" + browserVer + ">"); }}// --></script>

<!--  Generated by Natural Docs, version 1.5 -->
<!--  http://www.naturaldocs.org  -->

<!-- saved from url=(0026)http://www.naturaldocs.org -->




<div id=Content><div class="CSection"><div class=CTopic id=MainTopic><h1 class=CTitle><a name="Описание"></a>Описание</h1><div class=CBody><p>Модуль применяется для форматирования и сравнения данных.</p><p>Основная цель создания модуля: собрать в одном месте низкоуровневые правила сравнения клиентских данных, которые приходится использовать в различных задачах, связанных с поиском и дедупликацией клиентов.</p><p>Пример: игнорирование различий между буквами &ldquo;и&rdquo; и &ldquo;й&rdquo; при сравнении ( в связи с часто встречающейся ошибкой в этих буквах при вводе данных), игнорирование несущественных различий в написании имен и отчеств с помощью использования синонимов ( &ldquo;Наталья&rdquo; и &ldquo;Наталия&rdquo;).</p><h4 class=CHeading>Предоставляемые модулем функции ( <a href="../pkg_FormatData-pks.html#pkg_FormatData" class=LPackage id=link1 onMouseOver="ShowTip(event, 'tt1', 'link1')" onMouseOut="HideTip('tt1')">pkg_FormatData</a>)</h4><ul><li>format* ( форматирование);</li></ul><p>Функции выполняют естественное форматирование входных данных, удобное для последующего просмотра и поиска, без существенного изменения самих данных.</p><ul><li>getBase* ( базовая форма);</li></ul><p>Возвращают базовую форму для исходных данных ( в т.ч.&nbsp; с использованием справочника синонимов), предназначенную для поиска, возможно существенно отличающуюся от исходных данных.</p><ul><li>check* ( проверка корректности)</li></ul><p>Проверяет корректность указанного значения ( например, для номера ИНН проверяется контрольная сумма).</p><p>Для всех функций предоставляются парные функции *Expr, которые возвращают SQL-выражение, позволяющее получить тот же самый результат, для использования в динамическом SQL.&nbsp; Использование этих функций в динамическом SQL вместо вызова PL/SQL вариантов позволяет получить существенный выигрыш в производительности на больших объемах данных ( пример: использовие SQL-выражений из функции getBaseCodeExpr для трех полей на 260 тыс.&nbsp; записей в динамическом SQL работает более чем в 3 раза быстрее чем вызов из SQL функций getBaseCode на 260 тыс.&nbsp; записей).</p><h4 class=CHeading>Примерная схема использования другими модулями</h4><ul><li>при регулярном обновлении исходных данных выполняется форматирование данных с помощью функций Format* и сохранение их в таблицу;</li></ul><p>При использовании функций getBase* рекомендуется сохранять в этой же таблице исходное значение.</p><blockquote><pre>  ...
                                        --Получаем данные
  execute immediate '
insert into
  tmp_table
(
  id
  , last_name
  , first_name
  , middle_name
  , birth_year
  , birth_month
  , birth_day
  , passport_serie
  , passport_number
  , base_last_name
  , base_first_name
  , base_middle_name
  , base_passport_serie
  , base_passport_number
)
select
  a.id
  , a.last_name
  , a.first_name
  , a.middle_name
  , ' || pkg_FormatData.formatCodeExpr( 'to_char( a.birth_year)', 4) || '
    as birth_year
  , ' || pkg_FormatData.formatCodeExpr( 'to_char( a.birth_month)', 2) || '
    as birth_month
  , ' || pkg_FormatData.formatCodeExpr( 'to_char( a.birth_day)', 2) || '
    as birth_day
  , a.passport_serie
  , a.passport_number
  , ' || pkg_FormatData.getBaseLastNameExpr( 'a.last_name') || '
    as base_last_name
  , ' || pkg_FormatData.getBaseFirstNameExpr( 'a.first_name') || '
    as base_first_name
  , ' || pkg_FormatData.getBaseMiddleNameExpr( 'a.middle_name') || '
    as base_middle_name
  , ' || pkg_FormatData.getBaseCodeExpr( 'a.passport_serie') || '
    as base_passport_serie
  , ' || pkg_FormatData.getBaseCodeExpr( 'a.passport_number') || '
    as base_passport_number
from
  tmp_table@' || sourceDbLink || ' a
'
  ;
  ...</pre></blockquote><ul><li>для выполнения поиска ключевые значения форматируются по тем же самым правилам, что и при обновлении данных, после чего выполняется поиск по сохраненным в таблице индексированным полям;</li></ul><blockquote><pre>...
                                      --Выполняем поиск
DoFind(
  lastName          =&gt; pkg_FormatData.getBaseLastName( lastName)
  , firstName       =&gt; pkg_FormatData.getBaseFirstName( firstName)
  , middleName      =&gt; pkg_FormatData.getBaseMiddleName( middleName)
  , lastNameOld     =&gt; pkg_FormatData.getBaseLastName( lastNameOld)
  , birthYear       =&gt; pkg_FormatData.formatCode( birthYear, 4)
  , birthMonth      =&gt; pkg_FormatData.formatCode( birthMonth, 2)
  , birthDay        =&gt; pkg_FormatData.formatCode( birthDay, 2)
  , passportSerie   =&gt; pkg_FormatData.getBaseCode( passportSerie)
  , passportNumber  =&gt; pkg_FormatData.getBaseCode( passportNumber)
);
...</pre></blockquote></div></div></div>

</div><!--Content-->


<div id=Footer><a href="http://www.naturaldocs.org">Generated by Natural Docs</a></div><!--Footer-->


<div id=Menu><div class=MTitle>FormatData<div class=MSubTitle>Версия 1.4.0</div></div><div class=MEntry><div class=MGroup><a href="javascript:ToggleMenu('MGroupContent1')">О модуле</a><div class=MGroupContent id=MGroupContent1><div class=MEntry><div class=MFile id=MSelected>Описание</div></div><div class=MEntry><div class=MFile><a href="install-txt.html">Установка</a></div></div><div class=MEntry><div class=MFile><a href="bugs-txt.html">Ошибки</a></div></div><div class=MEntry><div class=MFile><a href="todo-txt.html">Доработки</a></div></div><div class=MEntry><div class=MFile><a href="../Makefile-.html">Сборка</a></div></div><div class=MEntry><div class=MFile><a href="version-txt.html">Версии</a></div></div></div></div></div><div class=MEntry><div class=MGroup><a href="javascript:ToggleMenu('MGroupContent4')">Пакеты</a><div class=MGroupContent id=MGroupContent4><div class=MEntry><div class=MGroup><a href="javascript:ToggleMenu('MGroupContent2')">pkg_FormatBase</a><div class=MGroupContent id=MGroupContent2><div class=MEntry><div class=MFile><a href="../pkg_FormatBase-pks.html">Спецификация</a></div></div><div class=MEntry><div class=MFile><a href="../pkg_FormatBase-pkb.html">Реализация</a></div></div></div></div></div><div class=MEntry><div class=MGroup><a href="javascript:ToggleMenu('MGroupContent3')">pkg_FormatData</a><div class=MGroupContent id=MGroupContent3><div class=MEntry><div class=MFile><a href="../pkg_FormatData-pks.html">Спецификация</a></div></div><div class=MEntry><div class=MFile><a href="../pkg_FormatData-pkb.html">Реализация</a></div></div></div></div></div></div></div></div><div class=MEntry><div class=MGroup><a href="javascript:ToggleMenu('MGroupContent13')">Скрипты</a><div class=MGroupContent id=MGroupContent13><div class=MEntry><div class=MGroup><a href="javascript:ToggleMenu('MGroupContent11')">Install</a><div class=MGroupContent id=MGroupContent11><div class=MEntry><div class=MGroup><a href="javascript:ToggleMenu('MGroupContent5')">Config</a><div class=MGroupContent id=MGroupContent5><div class=MEntry><div class=MFile><a href="../Install/Config/after-action-sql.html">after-action</a></div></div><div class=MEntry><div class=MFile><a href="../Install/Config/before-action-sql.html">before-action</a></div></div></div></div></div><div class=MEntry><div class=MGroup><a href="javascript:ToggleMenu('MGroupContent7')">Grant</a><div class=MGroupContent id=MGroupContent7><div class=MEntry><div class=MGroup><a href="javascript:ToggleMenu('MGroupContent6')">Last</a><div class=MGroupContent id=MGroupContent6><div class=MEntry><div class=MFile><a href="../Install/Grant/Last/run-sql.html">run</a></div></div></div></div></div></div></div></div><div class=MEntry><div class=MGroup><a href="javascript:ToggleMenu('MGroupContent10')">Schema</a><div class=MGroupContent id=MGroupContent10><div class=MEntry><div class=MGroup><a href="javascript:ToggleMenu('MGroupContent8')">Last</a><div class=MGroupContent id=MGroupContent8><div class=MEntry><div class=MFile><a href="../Install/Schema/Last/run-sql.html">run</a></div></div><div class=MEntry><div class=MFile><a href="../Install/Schema/Last/revert-sql.html">revert</a></div></div><div class=MEntry><div class=MFile><a href="../Install/Schema/Last/fd_alias-tab.html">fd_alias</a></div></div><div class=MEntry><div class=MFile><a href="../Install/Schema/Last/fd_alias_biu_format-trg.html">fd_alias_biu_format</a></div></div><div class=MEntry><div class=MFile><a href="../Install/Schema/Last/fd_alias_type-tab.html">fd_alias_type</a></div></div><div class=MEntry><div class=MFile><a href="../Install/Schema/Last/v_fd_first_name_alias-vw.html">v_fd_first_name_alias</a></div></div><div class=MEntry><div class=MFile><a href="../Install/Schema/Last/v_fd_middle_name_alias-vw.html">v_fd_middle_name_alias</a></div></div><div class=MEntry><div class=MFile><a href="../Install/Schema/Last/v_fd_no_value_alias-vw.html">v_fd_no_value_alias</a></div></div></div></div></div><div class=MEntry><div class=MGroup><a href="javascript:ToggleMenu('MGroupContent9')">1.4.0</a><div class=MGroupContent id=MGroupContent9><div class=MEntry><div class=MFile><a href="../Install/Schema/1-4-0/run-sql.html">run</a></div></div></div></div></div></div></div></div></div></div></div><div class=MEntry><div class=MGroup><a href="javascript:ToggleMenu('MGroupContent12')">Test</a><div class=MGroupContent id=MGroupContent12><div class=MEntry><div class=MFile><a href="../Test/expr-function-sql.html">expr-function</a></div></div></div></div></div></div></div></div><div class=MEntry><div class=MGroup><a href="javascript:ToggleMenu('MGroupContent17')">Индекс</a><div class=MGroupContent id=MGroupContent17><div class=MEntry><div class=MGroup><a href="javascript:ToggleMenu('MGroupContent14')">Объекты БД</a><div class=MGroupContent id=MGroupContent14><div class=MEntry><div class=MIndex><a href="../../index/DatabaseViews.html">Представления</a></div></div><div class=MEntry><div class=MIndex><a href="../../index/DatabaseTables.html">Таблицы</a></div></div><div class=MEntry><div class=MIndex><a href="../../index/DatabaseTriggers.html">Триггеры</a></div></div></div></div></div><div class=MEntry><div class=MGroup><a href="javascript:ToggleMenu('MGroupContent15')">Открытые объявления</a><div class=MGroupContent id=MGroupContent15><div class=MEntry><div class=MIndex><a href="../../index/Constants.html">Константы</a></div></div><div class=MEntry><div class=MIndex><a href="../../index/Functionspublic.html">Функции</a></div></div></div></div></div><div class=MEntry><div class=MGroup><a href="javascript:ToggleMenu('MGroupContent16')">Закрытые объявления</a><div class=MGroupContent id=MGroupContent16><div class=MEntry><div class=MIndex><a href="../../index/Typesinternal.html">Типы</a></div></div><div class=MEntry><div class=MIndex><a href="../../index/Constantsinternal.html">Константы</a></div></div><div class=MEntry><div class=MIndex><a href="../../index/Variablesinternal.html">Переменные</a></div></div></div></div></div><div class=MEntry><div class=MIndex><a href="../../index/Functions.html">Функции</a></div></div><div class=MEntry><div class=MIndex><a href="../../index/Files.html">Скрипты</a></div></div><div class=MEntry><div class=MIndex><a href="../../index/General.html">Все вместе</a></div></div></div></div></div><script type="text/javascript"><!--
var searchPanel = new SearchPanel("searchPanel", "HTML", "../../search");
--></script><div id=MSearchPanel class=MSearchPanelInactive><input type=text id=MSearchField value=Search onFocus="searchPanel.OnSearchFieldFocus(true)" onBlur="searchPanel.OnSearchFieldFocus(false)" onKeyUp="searchPanel.OnSearchFieldChange()"><select id=MSearchType onFocus="searchPanel.OnSearchTypeFocus(true)" onBlur="searchPanel.OnSearchTypeFocus(false)" onChange="searchPanel.OnSearchTypeChange()"><option  id=MSearchEverything selected value="General">Everything</option><option value="Constants">Constants</option><option value="Constantsinternal">Constants internal</option><option value="DatabaseTables">Database Tables</option><option value="DatabaseTriggers">Database Triggers</option><option value="DatabaseViews">Database Views</option><option value="Files">Files</option><option value="Functions">Functions</option><option value="Functionspublic">Functions public</option><option value="Typesinternal">Types internal</option><option value="Variablesinternal">Variables internal</option></select></div><script language=JavaScript><!--
HideAllBut([1, 4, 13, 17], 18);// --></script></div><!--Menu-->



<!--START_ND_TOOLTIPS-->
<div class=CToolTip id="tt1"><div class=CPackage>Интерфейсный пакет модуля FormatData.</div></div><!--END_ND_TOOLTIPS-->




<div id=MSearchResultsWindow><iframe src="" frameborder=0 name=MSearchResults id=MSearchResults></iframe><a href="javascript:searchPanel.CloseResultsWindow()" id=MSearchResultsWindowClose>Close</a></div>


<script language=JavaScript><!--
if (browserType) {if (browserVer) {document.write("</div>"); }document.write("</div>");}// --></script></body></html>