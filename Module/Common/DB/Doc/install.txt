title: Установка


group: Общие замечания

Параметры установки:
INSTALL_VERSION               - устанавливаемая версия модуля ( Last при
                                первоначальной установке или номер при
                                обновлении)
LOAD_OPERATORID               - логин и пароль оператора, выполняющего установку
                                ( формат: login/password)
LOAD_USERID                   - основной пользователь для установки в БД
                                ( формат: username/password@dbName)
TO_USERNAME                   - имя пользователя, которому выдаются права
                                ( формат: username)



Дополнительные параметры:
BATCH_WAIT                    - ожидание окончания работы батчей в секундах
                                ( по умолчанию 60)
JOB_QUEUE_PROCESSES           - новое значение параметра JOB_QUEUE_PROCESSES
                                после завершения установки ( по умолчанию
                                используется сохранненое перед установкой)



Перед установкой модуль останавливает выполнение заданий в БД ( см.
<Install/Config/stop-batches.sql>), а после успешной установки восстанавливает
их выполнение ( см. <Install/Config/resume-batches.sql>).
При повторном запуске установки возможно появление сообщения
"Warning. There's a non-zero value saved in view...",
которое говорит о том, что используется значение параметра JOB_QUEUE_PROCESSES,
запомненного при предыдущем запуске установки.


В случае ошибок при установке:

- ошибка "Batch stop waiting timed out"

В зависимости от работающих батчей, есть вариант увеличить BATCH_WAIT.
Пример запуска установки со временем ожидания 1000 секунд
( ??? нужно заменить на актуальные значения):

(code)

make install INSTALL_VERSION=??? LOAD_USERID=???/???@??? LOAD_OPERATORID=???/??? BATCH_WAIT=1000

(end)

- остальные ошибки

Рекомендуется перезапустить установку с параметром -i ( игнорирование ошибок ).
Можно тажке восстановить запуск заданий в БД:

(code)

$ make install-after LOAD_USERID=???/???@??? LOAD_OPERATORID=???/???

(end)



group: Первоначальная установка

Порядок для первоначальной установки последней версии модуля:

- выдача дополнительных прав на системные объекты ( в TO_USERNAME указывается
  пользователь, в схему которого будет установлен модуль)

(code)

$ make grant INSTALL_VERSION=Last LOAD_USERID=sys/???@??? TO_USERNAME=??? GRANT_SCRIPT=sys-privs

(end)

- установка объектов модуля

(code)

$ make install INSTALL_VERSION=Last LOAD_USERID=???/???@???

(end)

- выдача прав на использование модуля

Команда для выдачи прав на объекты модуля для всех пользователей
( у пользователя, в схему которого установлен модуль, должна быть системная
привилегия "CREATE PUBLIC SYNONYM"):

(code)

$ make grant INSTALL_VERSION=Last LOAD_USERID=???/???@??? TO_USERNAME=public

(end)

- выдача дополнительных прав через ACL

Команда для добавления smtp-сервера по-умолчанию в acl-лист ( актуально для 11
версии Oracle):

(code)

$ make grant INSTALL_VERSION=Last LOAD_USERID=sys/???@<TNS> GRANT_SCRIPT=acl-grant TO_USERNAME=<ОсновнойПользователь>

(end)

Для успешного выполнения функции <pkg_Common.getIpAddress> в Oracle 11 и выше
также требуется выдача дополнительных прав через ACL.

Замечания:
- для того, чтобы БД считалась промышленной ( а также для указания специальных
  настроек, например, SMTP-сервера) нужно модифицировать скрипт
  Install/Data/Last/cmn_database_config.sql, заполняющий таблицу
  <cmn_database_config> при установке;
