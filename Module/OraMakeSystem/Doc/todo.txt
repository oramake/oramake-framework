title: Доработки

[*] Выдавать ошибку при выполнении цели uninstall в случае отсутствия в
    модуле скрипта, который нужно выполнить для отмены установки.

[*] Перенести функционал скрипта <oms-auto-doc> в скрипт <oms> в качестве
    отдельной команды.

[+] Добавить make-переменные с именами подкаталогов, в которых расположены
    файлы отдельных частей модуля ( например, PART_SUBDIR2 для файлов,
    загружаемых по LOAD_USERID2 и т.д.). Доработать структуру map-файла и
    по умолчанию брать значения из соответствующих тэгов map-файла.
    При определении файлов, загружаемых или выполняемых в БД
    ( make-переменные loadTarget, installSchemaTarget, и т.д.) использовать
    стандартные make-функции ( например, getLoadTarget, getInstallSchemaTarget),
    которые будут возвращать все подходящие для загрузки файлы из
    соответствующих каталогов ( определяемых по PART_SUBDIR?). Это упростит
    настройку прикладного модуля ( в большинстве случаев будет достаточно
    установить значения тэгов в map-файле и добавить соответствующие файлы
    без изменения make-файла) и добавление новых частей в модуль ( сейчас
    приходится прописывать один и тот же подкаталог в нескольких местах
    make-файла).

[*] Получать установленную версию OMS для сохранения в логе установки с помощью
    специальной опции скрипта <oms-load> или <oms-common.sh> ( при этом версия
    должна определяться с учетом изменений любого из скриптов или
    конфигурационного файла).

[+] Переименовать префиксы csp,csl в cfp,cfl ( "CustomPublic" -> "ConfigPublic",
    "CustomLocal" -> "ConfigLocal") в файлах <connect.sh>, <database.mk>
    в Config/Default. Для этого необходимо обеспечить совместимость с
    предыдущими префиксами в Config/Default, так как новая версия OMS должна
    "уметь" работать с локальными файлами OMS ( <init.mk>) старых версий.

[*] Для перевода строки в верхний/нижний регистр в скриптах использовать
    встроенные возможности Bash 4 (например "${parameter,,}" для перевода в
    нижний регистр) вместо вызова внешней команды "tr". Удалить "tr" из
    установки для Windows.



Документирование:

[+] Корректировать версию OMS, указанную в файле Build/NaturalDocs/Menu.txt,
    при установке номера версии OMS командой "make set-oms-version ...".

[+] Использовать текст SQL-комментариев к таблицам и колонкам таблицы при
    документировании скриптов.

[*] Выделить используемую библиотеку NaturalDocs в отдельный модуль, чтобы
    ей можно было пользоваться в других проектах.

[*] Настроить документирование outline-ограничений и материализованных логов.

[*] Было бы удобно, если бы описание в Map-файле бралось
    из описания модуля ( readme.txt ), например, из первой строки
    или из специально помеченной строки.

[*] Копировать документацию oms при установке и
    создать ссылку на неё из документации модуля.

[*] Генерировать прототипы функций пакета на основе прототипов
    в теле.


Загрузка:

[*] Добавить не выполняющий никаких действий скрипт oms-nothing.sql
    ( полезен при динамическом выборе выполняемых скриптов) и удалить
    соответсвующий внутренний скрипт <OmsInternal/nothing.sql>.

[*] В скрипте <oms-load> необходимо автоматически находить контрольный файл
    для загрузки файла данных в случае, если он расположен на два уровня
    выше ( например, контрольный файл в Install/Data, а файл с данными в
    Install/Data/1.0.0/UserDB) либо использовать какую-то другую схему
    расположения контрольных файлов, используемых при загрузке данных из
    нескольких файлов данных.

[*] В случае отсутствия значения параметра <LOAD_USERID> формировать его по
    <LOAD_DB> и имени пользователя по-умолчанию для БД в файле DB/Makefile
    рядом с определением параметра ( при этом нужно будет перенести определение
    имени пользователя по имени БД из скрипта <oms-connect-info> в
    make-функцию). Это позволит успешно определять значение параметра
    <LOCAL_USER_DIR> при указании только <LOAD_DB9>. Аналогичную схему
    применить и для остальных параметров LOAD_USERID?.

[+] Автоматически генерить зависимости для загружаемых объектов ( минимально
    тривиальные для тела и спецификации пакета, по возможности обновлять из
    базы после успешной загрузки).

[+] Не загружать повторно PL/SQL-объекты, которые идентичны имеющимся в БД.

[+] При загрузке данных с помощью SQL*Loader устанавливать значение поля
    operator_id в соответствии со значением LOAD_OPERATORID.

[+] Добавить стандартное расширение для файлов с функциями.



Установка:

[+] По возможности сохранять в БД информацию об ошибках при установке файла.

[*] Добавить в Doc/map.xml тэг previousVersion, обновлять его при установке
    текущей версии модуля и использовать его значение для параметра
    <UNINSTALL_RESULT_VERSION>.

[+] Добавить поддержку отмены выдачи прав ( обратная цель для grant).

[+] Проверять DML-блокировки перед установкой.

[+] Выводить время начала и завершения установки в лог.

[+] Доработать скрипт <oms-refresh-mview.sql> в плане более эффективного
    выполнения полного обновления: перед обновлением индексы должны
    переводиться в статус UNUSABLE, а после установки должен выполняться REBUID
    ( доработка требует предварительного тестирования).

[*] Добавить параметр --dry-sql для <oms-load> и
    для make-файла модуля, позволяющий записывать в файлы
    точные тексты sql, выполняемые oms, вместо передачи их
    на вход утилите sqlplus.

[+] Добавить возможность копирования лог-файлов после установки
    в заданный каталог.



Завершение доработок:

[-] Через определенное время после начала использования OMS версии 2.0.0
    удалить скрипт <oms-module( DEPRECATED)>, обеспечивающий совместимость
    с прикладными модулями, использующими OMS-файлы версии ниже 2.0.0.

[-] Удалить из дистрибутива для Windows пакет dos2unix, т.к. утилиты
    dos2unix и unix2dos перестали использоваться в OMS начиная с версии 2.4.0.
