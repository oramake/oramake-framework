Title: Структура каталогов



group: Общая структура

(start table)

- корневой каталог модуля ( каталог ModuleName/Trunk в SVN)

  - DB ( исходные файлы, относяциеся к базе данных)

    - Do ( скрипты для выполнения различных операций)

    - Doc ( исходные файлы документации)

      bugs.txt    - известные ошибки
      install.txt - установка
      readme.txt  - общее описание
      version.txt - версии модуля с описанием изменений
      todo.txt    - возможные доработки

    - Install ( скрипты для установки)

      - Config ( дополнительные настройки и скрипты для установки модуля)

        - N.N.N ( дополнительные настройки для версии N.N.N)

          Revert ( дополнительные настройки при отмене изменений)

            after-action.sql  - завершающие действия при отмене изменений
                                ( для версии N.N.N)
            before-action.sql - предварительные действия при отмене изменений
                                ( для версии N.N.N)
            define.mk         - дополнительные настройки make при отмене
                                изменений ( для версии N.N.N)

          after-action.sql  - завершающие действия при установке
                              ( для версии N.N.N)
          before-action.sql - предварительные действия при установке
                              ( для версии N.N.N)
          define.mk         - дополнительные настройки make при установке
                              ( для версии N.N.N)

        after-action.sql  - завершающие действия при установке и отмене
                            изменений
        before-action.sql - предварительные действия при установке и отмене
                            изменений
        define.mk         - дополнительные настройки make при установке и отмене
                            изменений

      - Batch ( батчи модуля)

        - Last ( батчи последней версии модуля)

          - Local ( локальные данные, см. "Расположение локальных скриптов")

            - Database1

              batch_config.xml          - данные настроек батчей в БД Database1

          - PublicJob ( интерфейсные job, которые могут быть использованы в других модулях)

            <job_short_name>.job.xml    - данные интерфейсных job-ов модуля,
                                          которые могут быть использованы в других
                                          модулях

          - BatchShortName1 ( имя каталога совпадает с именем батча)

            batch.xml   - данные батча

            <job_short_name_1>.job.xml  - job-ы уровня видимости батча, могут быть
                                          использованы только в данном батче

            <job_short_name_2>.job.xml

            <job_short_name>.job.xml    - job-ы уровня видимости модуля, которые
                                          могут быть использованы в нескольких батчах
                                          модуля

            revert.sql                  - скрипт удаляющий батчи модуля

      - Data ( скрипты загрузки данных)

        - Last ( скрипты загрузки последней версии данных)

          - Local ( локальные данные, см. "Расположение локальных скриптов")

          run.sql       - скрипт загрузки ( при наличии обычные файлы *.sql
                          этого каталога не загружаются)
          run-after.sql - завершающий скрипт загрузки ( при наличии обычные
                          файлы *.sql этого каталога не загружаются)
          revert.sql    - отмена изменений, внесенных в данные при установке

        - N.N.N ( скрипты изменения данных для версии N.N.N)

      - Grant ( скрипты выдачи прав/создания синонимов указанному пользователю
          БД ( имя пользователя передается в первом параметре скрипта))

        - Last  ( скрипты для последней версии модуля)

          - Local ( локальные права, см. "Расположение локальных скриптов")

          run.sql       - полные права на использование модуля

          read-only.sql - права для доступа только по чтению ( например)

          sys-privs.sql - дополнительные системные привилегии и права на
                          системные объекты, необходимые для установки и
                          работы модуля

        - N.N.N ( дополнительные права/синонимы, добавившиеся в версии N.N.N)

          run.sql       - дополнительные права для полного доступа, выдаваемые
                          с версии N.N.N

      - Schema ( скрипты для установки схемы)

        - Last  ( скрипты первоначальной установки последней версии схемы)

          - Local ( локальные объекты, см. "Расположение локальных скриптов")

          run.sql     - стартовый скрипт создания объектов схемы
          revert.sql  - отмена изменений, внесенных в схему при установке

        - N.N.N ( скрипты миграции схемы с предыдущей версии до версии N.N.N)

          Revert ( предыдущие версии объектов, заливаемые при отмене изменений)

            *.*       - исходники предыдущей версии программных единиц ( пакеты,
                        процедуры, объектные типы и т.д.), а также других
                        загружаемых объектов ( представления, триггеры)

          run.sql     - стартовый скрипт
          revert.sql  - отмена изменений, внесенных в схему при установке

    - Java ( Java-файлы, исключая файлы *.jav с java source)

      - UsedLib ( загружаемые в БД Java-библиотеки)

        - LibName ( ветка, относящаяся к библиотеке LibName)

          - libname-x.x.x ( распакованный дистрибутив библиотеки)

          readme.txt  - краткое поясненеие по использованию библиотеки

    - Local ( локальные программные единицы,
              см. "Расположение локальных скриптов")

    - OmsModule ( файлы, обеспечивающие работу OMS)

      - Load ( временные файлы загрузки в БД, изменения содержимого должны
               игнорироваться SVN)

        - Log ( логи и другие файлы, созданные при загрузке в БД)

          - Install ( логи установки модуля в БД)

        - State ( файлы, отражающие факт загрузки в БД)

      - NaturalDocs ( файлы системы автодокументации)

        - Data ( кэш, изменения содержимого должны игнорироваться SVN)

        Languages.txt - языковые настройки ( меняется в рамках OMS)
        Menu.txt      - описывает меню документации ( специфичный для модуля)
        Topics.txt    - настройки ключевых слов ( меняется в рамках OMS)

      common.mk   - общие настройки для make ( обычно меняется в рамках OMS)

    - Show ( скрипты для просмотра данных, логов и т.д.)

    - Test ( скрипты для тестирования функционала при разработке)

    Makefile    - специфичные для БД-части модуля настройки make
    loaddeps.mk - зависимости при загрузке файлов в БД

    *.*         - исходники программных единиц ( пакеты, процедуры, объектные
                  типы и т.д.)

  - Doc ( документация)

    - DB ( документация в части, относящейся к базе данных)

      - AutoGen ( автогенерируемая на основе файлов в DB документация)

        index.html  - стартовый файл документации

    map.xml   - map-файл модуля

  Makefile - специфичные для модуля настройки make

(end table)



Замечания:

- структурные каталоги должные создаваться только при необходимости ( т.е.
  при наличии соответствующих скриптов в модуле), пустые каталоги создавать не
  нужно;



group: Расположение локальных скриптов

Скрипты, относящиеся только к конкретной промышленной БД, расположены в ветке,
начинающейся с каталога Local. Каталог Local может находиться в различных
каталогах в зависимости от назначения скриптов, например DB/Local для скиптов
пакетов, DB/Install/Schema/Last/Local для скриптов других объектов схемы.

В каталоге Local создаются подкаталоги с именами, точно соответствующими имени
промышленной БД, для которой предназначены скрипты. Имя подкаталога должно
совпадать ( с учетом регистра) с именем промышленной БД, возвращаемым функцией
<getProductionDbName>.

В случае, если имя пользователя, под которым должны загружаться скрипты,
несущественно ( предполагается загрузка под основным пользователем БД, под
которым устанавливаются программные модули), файлы со скриптами создаются
непосредственно в подкаталоге, соответствующем этой БД.

В случае, если скрипты предназначены для конкретного пользователя указанной
БД, в подкаталоге, соответствующем БД, создаются подкаталоги с именами
пользователей ( в нижнем регистре), в которых располагаются скрипты.

Пример ( скрипты для основного пользователя БД):

в каталоге DB/Install/Data/Last/Local/RFInfoP находятся скрипты загрузки данных,
предназначенные только для БД RFInfoP и загружаемые под основным пользователем
этой БД.

Пример ( скрипты для указанного пользователя БД):

в каталоге DB/Install/Schema/Last/Local/RFInfoP/cl находятся скрипты для
создания объектов под пользователем cl в БД RFInfoP.
