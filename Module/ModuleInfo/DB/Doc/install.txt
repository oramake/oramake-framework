title: Установка



group: Общие замечания

Реализуется с помощью целей сборки модуля из make-целей <Установка модуля в БД>.
Для корректной установки должна быть установлена актуальная версия OMS
( см. <Версия OMS-файлов>).

Параметры установки:
INSTALL_VERSION               - устанавливаемая версия модуля ( Last при
                                первоначальной установке или номер при
                                обновлении)
LOAD_OPERATORID               - логин и пароль оператора, выполняющего
                                установку, параметр указывается только в случае
                                наличия в БД модуля AccessOperator
                                ( формат: login/password)
LOAD_USERID                   - основной пользователь для установки в БД
                                ( формат: username/password@dbName)

Дополнительные параметры:
BATCH_WAIT                    - ожидание окончания работы батчей в секундах
                                ( по умолчанию 60)
JOB_QUEUE_PROCESSES           - новое значение параметра JOB_QUEUE_PROCESSES
                                после завершения установки ( по умолчанию
                                используется сохранненое перед установкой)
NO_ACCESSOPERATOR             - флаг отсутствия в БД модуля AccessOperator
                                ( "1" отсутствует ( при этом не создаются
                                внешние ключи на таблицу op_operator), 0
                                присутствует, по умолчанию 0)


В случае наличия в БД модуля Scheduler перед установкой модуль останавливает
выполнение заданий в БД ( см. <Install/Config/before-action.sql>), а после
успешной установки восстанавливает их выполнение ( см.
<Install/Config/after-action.sql>).
При повторном запуске установки возможно появление сообщения
"Warning. There's a non-zero value saved in view...",
которое говорит о том, что используется значение параметра JOB_QUEUE_PROCESSES,
запомненного при предыдущем запуске установки.

В случае ошибки при установке "Batch stop waiting timed out" батчей, можно
попробовать увеличить BATCH_WAIT.
Пример запуска установки со временем ожидания 1000 секунд

(code)

make install INSTALL_VERSION=??? LOAD_USERID=???/???@??? LOAD_OPERATORID=???/??? BATCH_WAIT=1000

(end)

В случае невозможности в данный момент выполнить установку можно восстановить
запуск заданий в БД:

(code)

$ make install-after LOAD_USERID=???/???@??? LOAD_OPERATORID=???/???

(end)



group: 1.2.1

Порядок установки:

- установка в основную схему

(code)

$ make install INSTALL_VERSION=1.2.1 LOAD_USERID=???/???@??? LOAD_OPERATORID=???/???

(end)

Замечания:
- в случае отсутствия в БД модуля AccessOperator параметр LOAD_OPERATORID
  указывать не надо;



group: Первоначальная установка

Предварительные требования:
- использование для установки OraMakeSystem версии не ниже 1.6.1;
- пользователю, под которым выполняется установка, дожно быть доступно
  табличное пространство для индексов со стандартным именем ( см. скрипт
  OraMakeSystem/SqlScript/oms-set-indexTablespace.sql) либо используемое
  для индексов табличное пространство должно быть явно указано с помощью
  добавления в команду установки параметра <SQL_DEFINE> ( например, для
  создания индексов в табличном пространстве USERS в команду установки нужно
  добавить " SQL_DEFINE=indexTablespace=USERS");

Порядок первоначальной установки:

- установка объектов модуля

В случае отсутствия в БД модуля AccessOperator используется команда

(code)

$ make install INSTALL_VERSION=Last LOAD_USERID=???/???@??? NO_ACCESSOPERATOR=1

(end)

а при наличии AccessOperator используется команда

(code)

$ make install INSTALL_VERSION=Last LOAD_USERID=???/???@??? LOAD_OPERATORID=???/???

(end)

- выдача прав на сохранение информации об установках модулей пользователям,
  под которыми будет выполняться установка

(code)

$ make grant INSTALL_VERSION=Last LOAD_USERID=???/???@??? LOAD_OPERATORID=???/??? GRANT_SCRIPT=save-install-info.sql TO_USERNAME=???

(end)

при
этом:
- в случае отсутствия в БД модуля AccessOperator параметр LOAD_OPERATORID
  указывать не надо;
- для выдачи прав всем пользователям в качестве значения TO_USERNAME нужно
  указать PUBLIC;
- для выдачи прав необходимо наличие привилегии "CREATE ANY SYNONYM" в случае
  выдачи прав конкретному пользователю или "CREATE PUBLIC SYNONYM" в случае
  выдачи прав всем пользователям;

Замечания:
- для установки модуля не требуется наличие каких-либо других модулей;



group: Удаление модуля из БД

Команда для удаления модуля из БД:

(code)

$ make uninstall INSTALL_VERSION=Last LOAD_USERID=???/???@???

(end)
