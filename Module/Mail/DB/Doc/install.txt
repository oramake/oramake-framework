title: Установка

group: Общие замечания

Параметры установки:
INSTALL_VERSION               - устанавливаемая версия схемы ( Last при
                                первоначальной установке или номер при
                                обновлении, например 1.1.0)
LOAD_OPERATORID               - логин и пароль оператора, выполняющего установку
                                ( формат: login/password)
LOAD_USERID                   - основная схема для установки
                                ( формат: username/password@dbName)
TO_USERNAME                   - имя пользователя, которому выдаются права
                                ( формат: username)



Дополнительные параметры:
STOP_JOB                      - останавливать выполнение заданий в БД на время
                                установки обновления модуля
                                ( 1 да, 0 нет ( по умолчанию))
BATCH_WAIT                    - ожидание окончания работы батчей в секундах
                                ( по умолчанию 60)
JOB_QUEUE_PROCESSES           - новое значение параметра JOB_QUEUE_PROCESSES
                                после завершения установки ( по умолчанию
                                используется сохранненое перед установкой)
MASS_DISTRIBUTION_SMTP        - имя или ip smtp-сервера для массовых рассылок
                                При задании устанавливается в качестве значение опции
                                модуля Option с именем <pkg_MailInternal.MassDistributeSmtp_OptionName>
FAX_SENDER_SMTP               - имя или ip smtp-сервера для отправки факсов
                                При задании устанавливается в качестве значение опции
                                модуля Option с именем <pkg_MailInternal.FaxSenderSmtp_OptionName>


В случае указания STOP_JOB=1 перед установкой обновления модуля останавливается
выполнение заданий в БД ( см.  <Install/Config/stop-batches.sql>), а после
успешной установки их выполнение восстанавливается ( см.
<Install/Config/resume-batches.sql>). При повторном запуске установки возможно
появление сообщения "Warning. There's a non-zero value saved in view...",
которое говорит о том, что используется значение параметра JOB_QUEUE_PROCESSES,
запомненного при предыдущем запуске установки.

В случае ошибок при установке:

- ошибка "Batch stop waiting timed out"

В зависимости от работающих батчей, есть вариант увеличить BATCH_WAIT.
Пример запуска установки со временем ожидания 1000 секунд
( ??? нужно заменить на актуальные значения):

(code)

make install INSTALL_VERSION=??? LOAD_USERID=???/???@??? LOAD_OPERATORID=???/??? STOP_JOB=1 BATCH_WAIT=1000

(end)

- остальные ошибки

Команда для восстановления выполнения заданий
в БД:

(code)

$ make install-after LOAD_USERID=???/???@??? LOAD_OPERATORID=???/??? STOP_JOB=1

(end)



group: Первоначальная установка

Предварительные требования:
- установка модуля Common;
- установка модуля Logging;
- установка модуля AccessOperator;
- установка модуля Option;
- установка модуля Scheduler;
- установка модуля TaskHandler;

Порядок для первоначальной установки последней версии модуля:

- выдача дополнительных прав на системные объекты ( в TO_USERNAME указывается
  пользователь, в схему которого будет установлен модуль)

(code)

$ make grant INSTALL_VERSION=Last LOAD_USERID=sys/???@??? LOAD_OPERATORID=???/??? GRANT_SCRIPT=sys-privs TO_USERNAME=???

(end)

( в случае, если у пользователя, под которым выдаются права, нет прав на
использование модуля ModuleInfo, то нужно отключить сохранение информации об
установке в ModuleInfo, дополнив команду строкой
"  OMS_SAVE_FILE_INSTALL_INFO=0 SKIP_FILE_MASK=*/oms-save-grant-info.sql"
и можно не указывать LOAD_OPERATORID
)

- установка объектов модуля

(code)

$ make install INSTALL_VERSION=Last LOAD_USERID=???/???@??? LOAD_OPERATORID=???/???

(end)



group: Выполнение тестов

Предварительные требования:
- установка модуля TestUtility;

Команда установки объектов для выполнения тестов ( можно также сразу установить
параметры тестирования с помощью <SQL_DEFINE>, см. следующий пример):

(code)

$ make install-test INSTALL_VERSION=Last LOAD_USERID=???/???@??? LOAD_OPERATORID=???/???

(end)

Команда для изменения параметров тестирования ( перечислены
в <pkg_MailTest::Параметры тестирования>, в примере устанавливается значение
SMTP-сервера ( <pkg_MailTest.TestSmtpServer_OptSName>) в "smtp.company.com"):

(code)

$ make -B install-test INSTALL_VERSION=Last LOAD_USERID=???/???@??? LOAD_OPERATORID=???/??? FILE_MASK=*/opt_option.sql SQL_DEFINE=TestSmtpServer=smtp.company.com

(end)

Команда для выполнения всех тестов:

(code)

$ make test INSTALL_VERSION=Last LOAD_USERID=???/???@??? LOAD_OPERATORID=???/???

(end)


group: Удаление модуля из БД

Команда для удаления модуля из БД:

(code)

$ make uninstall INSTALL_VERSION=Last LOAD_USERID=???/???@??? LOAD_OPERATORID=???/???

(end)
